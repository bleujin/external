<div class="inbox-nav-bar no-content-padding"></div>

<div id="inbox-content" class="inbox-body no-content-padding">
    <div class="inbox-side-bar">
        <div class="well no-padding">
            <form class="smart-form no-padding" method="post" action="domain/left" novalidate="novalidate">
                <fieldset>
                    <section class="no-padding">
                        <label class="label">${m.asString("domain.choose")}</label>
                        <label class="select">
                            <select class="input-sm choose-sub form-control" id="domains">
                            </select>
                        </label>
                    </section>
                </fieldset>
            </form>
        </div>

        <ul class="inbox-menu-lg">
            <li class="submenu active"><a class="overview-load" href="javascript:void(0);">${m.asString("menu.domain.overview")}</a></li>
            <li class="submenu"><a class="define-load" href="javascript:void(0);">${m.asString("menu.domain.define")}</a></li>
            <li class="submenu"><a class="article-load" href="javascript:void(0);">${m.asString("menu.domain.article")}</a></li>
            <li class="submenu"><a class="gallery-load" href="javascript:void(0);">${m.asString("menu.domain.gallery")}</a></li>

            <li><br/><br/>
            <li>
            <li class="dd-item" data-id="1">
                <div class="dd-handle create-open">
                    <span>${m.asString("domain.create")}</span>
                </div>
            </li>
        </ul>

        <div class="air air-bottom inbox-space">
            &nbsp;<a href="javascript:void(0);" rel="tooltip" title="" data-placement="left" data-original-title='${m.asString("menu.domain.remove")}' class="pull-right txt-color-darken"><i class="fa fa-trash-o fa-lg"></i></a>

            <div class="progress progress-micro">
                <div class="progress-bar progress-primary" style="width: 0%;"></div>
            </div>
        </div>
    </div>


    <div class="table-wrap custom-scroll animated fast fadeInRight">
        <!-- ajax will fill this area -->
        LOADING...

    </div>
</div>

<div id="article_view_modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 id="article_view_label">${m.asString("domain.article.data")}</h5></div>
            <div class="modal-body">
                <ul id="myTab1" class="nav nav-tabs bordered">
                    <li class="active"><a href="#s1" data-toggle="tab"><i class="fa fa-fw fa-lg fa-gear"></i>
                        ${m.asString("domain.article.data")}</a></li>
                    <li><a href="#s2" data-toggle="tab"><i class="fa fa-fw fa-lg fa-gear"></i>
                        ${m.asString("domain.article.related")}</a></li>
                </ul>
                <div id="myTabContent1" class="tab-content padding-10">
                    <div class="tab-pane fade in active" id="s1">
                        <form class="smart-form" id="article_view_form" method="post" action="domain/article" novalidate="novalidate">
                            <fieldset style="padding: 0px">
                                <section>
                                    <label class="label">${m.asString("domain.article.subject")}</label>
                                    <label class="input">
                                        <input type="text" id="subject" name="subject" value="This is article subject" readonly/>
                                    </label>
                                </section>
                                <section>
                                    <label class="label">${m.asString("domain.article.content")}</label>
                                    <label class="input">
                                        <textarea id="content" name="content" style="width: 70%" rows="10" readonly>Content...</textarea>
                                    </label>
                                </section>
                            </fieldset>
                        </form>
                    </div>
                    <div class="tab-pane fade" id="s2">
                        <table id="related_articles" class="table table-bordered table-hover" width="100%">
                            <thead>
                            <tr>
                                <th>${m.asString("domain.article.artid")}</th>
                                <th>${m.asString("domain.article.catid")}</th>
                                <th>${m.asString("domain.article.subject")}</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>101</td>
                                <td>/ics/external/airkjh2</td>
                                <td>This is article subject2</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}
                </button>
            </div>

        </div>
    </div>
</div>

<div id="remove-domain-confirm" title='${m.asString("domain.remove.title")}' style="display:none">
    <form class="smart-form" id="domain-form" method="post" action="domain/" novalidate="novalidate">
        <fieldset style="padding: 0px">
            <section>
                <label class="label">${m.asString("domain.remove")} : <span id="removeDomainId"></span></label>
            </section>
        </fieldset>
    </form>
</div>

<div id="create-domain-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="width:70%">
            <div class="modal-header"><h5 id="myModalLabel">${m.asString("domain.create")}</h5></div>
            <div class="modal-body">
                <form class="smart-form" id="create-domain-form" method="post" action="domain/" novalidate="novalidate">
                    <fieldset style="padding: 0px">
                        <section>
                            <label class="label">${m.asString("domain.id")}</label>
                            <label class="input">
                                <input type="text" id="did" name="did" placeholder="domain id"/>
                            </label>
                        </section>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}
                </button>
                <button class="btn btn-primary" name="create_domain">${m.asString("domain.create.button")}</button>
            </div>
        </div>
    </div>
</div>

<div id="story-pages-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 id="myModalLabel2">${m.asString("domain.article.template.storypage")}</h5></div>
            <div class="modal-body">
                <table id="story-pages" class="table table-bordered table-hover" width="100%">
                    <thead>
                    <tr>
                        <th>${m.asString("domain.article.template.tplid")}</th>
                        <th>${m.asString("domain.article.template.tplname")}</th>
                        <th>${m.asString("domain.article.template.form")}</th>
                        <th>${m.asString("domain.article.template.link")}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>1000</td>
                        <td>index.html</td>
                        <td>1</td>
                        <td>/scat/ninaninyo/external/airkjh/1000_100.html</td>
                    </tr>
                    <tr>
                        <td>1001</td>
                        <td>index2.html</td>
                        <td>2</td>
                        <td>/scat/ninaninyo/external/airkjh/1001_100.html</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}
                </button>
            </div>
        </div>
    </div>
</div>

<div id="list-pages-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel3" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 id="myModalLabel3">${m.asString("domain.source.scat.template.listpage")}</h5></div>
            <div class="modal-body">
                <table id="list-pages" class="table table-bordered table-hover" width="100%">
                    <thead>
                    <tr>
                        <th>${m.asString("domain.source.scat.template.tplid")}</th>
                        <th>${m.asString("domain.source.scat.template.tplname")}</th>
                        <th>${m.asString("domain.source.scat.template.form")}</th>
                        <th>${m.asString("domain.source.scat.template.link")}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>1000</td>
                        <td>index.html</td>
                        <td>1</td>
                        <td>/scat/ninaninyo/external/airkjh/index.html</td>
                    </tr>
                    <tr>
                        <td>1001</td>
                        <td>index2.html</td>
                        <td>2</td>
                        <td>/scat/ninaninyo/external/airkjh/index2.html</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}
                </button>
            </div>
        </div>
    </div>
</div>

<div id="create-domain-scat-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel4" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 id="myModalLabel4">${m.asString("domain.source.scat")}</h5></div>
            <div class="modal-body">
                <form class="smart-form" id="create-domain-scat-form" method="post" action="domain/" novalidate="novalidate">
                    <fieldset style="padding: 0px">
                        <section>
                            <label class="label">${m.asString("domain.scat.catid")}</label>
                            <label class="input">
                                <input type="text" id="scatid" name="scatid" placeholder="ics category id"/>
                            </label>
                        </section>
                        <section>
                            <label class="checkbox"><input type="checkbox" name="includeSub" value="T" /><i></i>${m.asString("domain.source.below")}</label>
                        </section>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}</button>
                <button class="btn btn-primary" name="create_scat">${m.asString("domain.source.create.button")}</button>
            </div>
        </div>
    </div>
</div>

<div id="create-domain-gcat-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel5" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 id="myModalLabel5">${m.asString("domain.source.gcat")}</h5></div>
            <div class="modal-body">
                <form class="smart-form" id="create-domain-gcat-form" method="post" action="domain/source" novalidate="novalidate">
                    <fieldset style="padding: 0px">
                        <section>
                            <label class="label">${m.asString("domain.source.gcat.catid")}</label>
                            <label class="input">
                                <input type="text" id="gcatid" name="gcatid" placeholder="ics category id"/>
                            </label>
                        </section>
                        <section>
                            <label class="checkbox"><input type="checkbox" name="below"/><i></i>${m.asString("domain.source.below")}</label>
                        </section>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}</button>
                <button class="btn btn-primary" name="create_source">${m.asString("domain.source.create.button")}</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    pageSetUp();

    var pagefunction = function () {

        function tableHeightSize() {
            if ($('body').hasClass('menu-on-top')) {
                var menuHeight = 68;
                // nav height

                var tableHeight = ($(window).height() - 224) - menuHeight;
                if (tableHeight < (320 - menuHeight)) {
                    $('.table-wrap').css('height', (320 - menuHeight) + 'px');
                } else {
                    $('.table-wrap').css('height', tableHeight + 'px');
                }

            } else {
                var tableHeight = $(window).height() - 224;
                if (tableHeight < 320) {
                    $('.table-wrap').css('height', 320 + 'px');
                } else {
                    $('.table-wrap').css('height', tableHeight + 'px');
                }
            }
        }

        // fix table height
        tableHeightSize();

        $(window).resize(function () {
            tableHeightSize();
        });


        var lastMenuHTML = 'overview.html';
        var lastDomainId = '' ;

        $.ajax({
            url:'/admin/domain/list',
            dataType:'json',
            success:function(data){
                for(var idx in data){
                    var did = data[idx] ;
                    var option = $('<option value="' + did + '">' + did + '</option>') ;
                    option.appendTo($("#domains")) ;
                }

                loadURL("external/domain/overview.html", $('#inbox-content > .table-wrap'));
                lastDomainId = $("#domains").val() ;
            },
            error:function(request,status,error){
                console.log('response', request, status, error) ;
                // until rest api ready...
                loadURL("external/domain/overview.html", $('#inbox-content > .table-wrap'));
            }
        }) ;

        $(".fa-trash-o").click(function () {
            $("#remove-domain-confirm").css('visibility', 'visible');
            $("#removeDomainId").html($("#domains option:selected").text());
            $("#remove-domain-confirm").dialog({
                modal: true,
                buttons: {
                    "${m.asString('domain.remove')}": function () {
                        var removeId = lastDomainId;
                        var win = $(this);

                        if (removeId > ' ') {
                            $.ajax({
                                type: "DELETE",
                                dataType: 'text',
                                url: "/admin/domain/" + $(".choose-sub").val(),
                                data: { },
                                complete: function () {
                                    // $("#query_url").text(this.url) ;
                                },
                                success: function (data) {
                                    $("#domains option:selected").remove();
                                    loadURL("external/domain/article.html", $('#inbox-content > .table-wrap'));
                                    lastMenuHTML = 'article.html' ;
                                    win.dialog("close");
                                }
                            });
                        }
                    },
                    "${m.asString('buttons.modal.cancel')}": function () {
                        $(this).dialog("close");
                    }
                }
            });
        });

        $('.create-open').click(function() {
            $('#create-domain-modal').modal({});
        });

        $("#create-domain-modal button[name=create_domain]").click(function () {
            $("#create-domain-form").submit();
        });

        $('#create-domain-form').validate({
            rules : {
                did : { required: true, pattern: "^[a-z][a-z0-9_]*$", minlength:4, maxlength: 15}
            },
            messages: {
                did : {
                    required: "${m.asString('validation.required', 'Domain ID')}",
                    pattern: "${m.asString('validation.idpattern')}",
                    minlength: "${m.asString('validation.minlength', 4)}",
                    maxlength: "${m.asString('validation.maxlength', 15)}"
                }
            },
            submitHandler: function(form) {
                var newId = $('#did').val() ;
                $.ajax({
                    type: 'POST',
                    dataType: 'text',
                    url: '/admin/domain/' + newId,
                    data: { },
                    complete: function() { },
                    success: function() {
                        if($('#domains option[value=' + newId + ']').length > 0) $('#domains').val(newId) ;
                        else $('#domains').append('<option value="' + newId + '" selected="selected">' + newId + '</option>');

                        $('#create-domain-modal').modal('hide') ;
                    }
                });
            },
            errorPlacement: function(error, element) {
                error.insertAfter(element.parent());
            }
        });

        $(".choose-sub").change(function () {
            loadURL("external/domain/" + lastMenuHTML, $('#inbox-content > .table-wrap'));
            lastDomainId = $('#domains').val();
        });

        $("li.submenu").click(function () {
            $(this).siblings().removeClass("active");
            $(this).addClass("active");
        });
        
        $(".overview-load").click(function () {
            loadURL("external/domain/overview.html", $('#inbox-content > .table-wrap'));
            lastMenuHTML = "overview.html";
        });        

        $(".define-load").click(function () {
            loadURL("external/domain/define.html", $('#inbox-content > .table-wrap'));
            lastMenuHTML = "define.html";
        });

        $(".article-load").click(function () {
            loadURL("external/domain/article.html", $('#inbox-content > .table-wrap'));
            lastMenuHTML = "article.html";
        });

        $(".gallery-load").click(function () {
            loadURL("external/domain/gallery.html", $('#inbox-content > .table-wrap'));
            lastMenuHTML = "gallery.html";
        });
    };

    pagefunction();

</script>
