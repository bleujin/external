<div class="inbox-nav-bar no-content-padding"></div>

<div id="inbox-content" class="inbox-body no-content-padding">
    <div class="inbox-side-bar">
        <div class="well no-padding">
            <form class="smart-form no-padding" method="post" action="domain/left" novalidate="novalidate">
                <fieldset>
                    <section class="no-padding">
                        <label class="label">${m.asString("menu.domain.choose")}</label>
                        <label class="select">
                            <select class="input-sm choose-sub form-control" id="domains">
                            </select>
                        </label>
                    </section>
                </fieldset>
            </form>
        </div>

        <ul class="inbox-menu-lg">
            <li class="submenu active"><a class="overview-load" href="javascript:void(0);">${m.asString("menu.domain.overview")}</a></li>
            <li class="submenu"><a class="defined-load" href="javascript:void(0);">${m.asString("menu.domain.defined")}</a></li>
            <li class="submenu"><a class="article-load" href="javascript:void(0);">${m.asString("menu.domain.article")}</a></li>
            <li class="submenu"><a class="gallery-load" href="javascript:void(0);">${m.asString("menu.domain.gallery")}</a></li>

            <li><br/><br/>
            <li>
            <li class="dd-item" data-id="1">
                <div class="dd-handle create-open">
                    <span>${m.asString("menu.domain.create")}</span>
                </div>
            </li>
        </ul>

        <div class="air air-bottom inbox-space">
            &nbsp;<a href="javascript:void(0);" rel="tooltip" title="" data-placement="left" data-original-title='${m.asString("menu.domain.remove")}' class="pull-right txt-color-darken"><i class="fa fa-trash-o fa-lg"></i></a>

            <div class="progress progress-micro">
                <div class="progress-bar progress-primary" style="width: 0%;"></div>
            </div>
        </div>
    </div>


    <div class="table-wrap custom-scroll animated fast fadeInRight">
        <!-- ajax will fill this area -->
        LOADING...

    </div>
</div>

<div id="article-view-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width: 800px;">
        <div class="modal-content">
            <div class="modal-header"><h5 id="article_view_label">${m.asString("domain.article.data")}</h5></div>
            <div class="modal-body" style="overflow-y: auto;">
                <ul id="myTab1" class="nav nav-tabs bordered">
                    <li class="active"><a href="#s1" data-toggle="tab"><i class="fa fa-fw fa-lg fa-gear"></i>
                        ${m.asString("domain.article.data")}</a></li>
                    <li><a href="#s2" data-toggle="tab"><i class="fa fa-fw fa-lg fa-gear"></i>
                        ${m.asString("domain.article.related")}</a></li>
                </ul>
                <div id="myTabContent1" class="tab-content padding-10">
                    <div class="tab-pane fade in active" id="s1">
                        
                        <h3 class="title_h3">${m.asString("domain.article.data.ginfo")} [<span title="artid"></span>]</h3>
						<table class="table_info" cellpadding="0" cellspacing="0">
						<tbody><tr><th class="info_th_bullet" width="120">${m.asString("domain.article.data.ginfo.reguser")}</th>
							<td><span title="reguserid"></span></td></tr>
						<tr><th class="info_th_bullet">${m.asString("domain.article.data.ginfo.title")}</th>
							<td><b><span title="subject"></span></b></td></tr>
						<tr><th>${m.asString("domain.article.data.ginfo.content")}</th>
							<td><div title="content" style="padding:3px;width:600px;height:200px;border:1px solid #B8B8B8;vertical-align:top; overflow:auto;"></div></td></tr>
						</tbody></table>
						
						
						<h3 class="title_h3">${m.asString("domain.article.data.addinfo")}</h3>
						<table class="table table_info" cellpadding="0" cellspacing="0">
						<tr><th>${m.asString("domain.article.data.addinfo.thumbnail")}</th>
							<td><span title="thumbnail"></span><br></td></tr>
						<tr><th>${m.asString("domain.article.data.addinfo.keyword")}</th>
							<td><span title="keyword"></span></td></tr>
						</tbody></table>
						
						<h3 class="title_h3">${m.asString("domain.article.data.sinfo")}</h3>
						<table class="table table-striped table_info" cellpadding="0" cellspacing="0">
						<tbody><tr><th width="120">${m.asString("domain.article.data.sinfo.operday")}</th>
							<td nowrap=""><span title="operday"></span></td></tr>
						<tr><th>${m.asString("domain.article.data.sinfo.expireday")}</th>
							<td nowrap=""><span title="expireday"></span></td></tr>
						<tr><th>${m.asString("domain.article.data.sinfo.urllink")}</th>
							<td><span title="gourlloc"></span><br></td></tr>
						<tr><th>${m.asString("domain.article.data.sinfo.priority")}</th>
							<td><span title="priority"></span></td></tr>
						<tr><th>${m.asString("domain.article.data.sinfo.artfilenm")}</th>
							<td><span title="artfilenm"></span></td></tr>
						</tbody></table>
						
						<h3 class="title_h3">${m.asString("domain.article.data.afieldinfo")}</h3>
                        <table id="afield-table" class="table table-striped table_info" cellpadding="0" cellspacing="0">
                            <thead><tr><th>${m.asString("domain.article.data.afieldinfo.id")}</th>
                            <th>${m.asString("domain.article.data.afieldinfo.value")}</th></tr></thead>
                            <tbody></table>
                        
                    </div>
                    <div class="tab-pane fade" id="s2">
                        <table id="related_articles" class="table table-bordered table-hover" width="100%">
                            <thead>
                            <tr>
                                <th>${m.asString("domain.article.artid")}</th>
                                <th>${m.asString("domain.article.catid")}</th>
                                <th>${m.asString("domain.article.subject")}</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}
                </button>
            </div>

        </div>
    </div>
</div>

<div id="remove-domain-confirm" title='${m.asString("domain.remove.title")}' style="display:none">
    <form class="smart-form" id="domain-form" method="post" action="domain/" novalidate="novalidate">
        <fieldset style="padding: 0px">
            <section>
                <label class="label">${m.asString("domain.remove")} : <span id="removeDomainId"></span></label>
            </section>
        </fieldset>
    </form>
</div>

<div id="create-domain-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="width:70%">
            <div class="modal-header"><h5 id="myModalLabel">${m.asString("domain.create")}</h5></div>
            <div class="modal-body">
                <form class="smart-form" id="create-domain-form" method="post" action="domain/" novalidate="novalidate">
                    <fieldset style="padding: 0px">
                        <section>
                            <label class="label">${m.asString("domain.id")}</label>
                            <label class="input">
                                <input type="text" id="did" name="did" placeholder="domain id"/>
                            </label>
                        </section>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}
                </button>
                <button class="btn btn-primary" name="create_domain">${m.asString("domain.create.button")}</button>
            </div>
        </div>
    </div>
</div>

<div id="story-pages-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 id="myModalLabel2">${m.asString("domain.article.template.storypage")}</h5></div>
            <div class="modal-body">
                <table id="story-pages" class="table table-bordered table-hover" width="100%">
                    <thead>
                    <tr>
                        <th>${m.asString("domain.article.template.tplid")}</th>
                        <th>${m.asString("domain.article.template.tplname")}</th>
                        <th class="col-md-2">${m.asString("domain.article.template.form")}</th>
                        <th>${m.asString("domain.article.template.link")}</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}
                </button>
            </div>
        </div>
    </div>
</div>

<div id="list-pages-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel3" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 id="myModalLabel3">${m.asString("domain.defined.scat.template.listpage")}</h5></div>
            <div class="modal-body">
                <table id="list-pages" class="table table-bordered table-hover" width="100%">
                    <thead>
                    <tr>
                        <th>${m.asString("domain.defined.scat.template.tplid")}</th>
                        <th>${m.asString("domain.defined.scat.template.tplname")}</th>
                        <th>${m.asString("domain.defined.scat.template.form")}</th>
                        <th>${m.asString("domain.defined.scat.template.link")}</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}
                </button>
            </div>
        </div>
    </div>
</div>

<div id="create-domain-scat-modal" class="modal fade domain" tabindex="-1" role="dialog" aria-labelledby="myModalLabel4" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 id="myModalLabel4">${m.asString("domain.defined.scat")}</h5></div>
            <div class="modal-body">
                <form class="smart-form" id="create-domain-scat-form" method="post" action="domain/" novalidate="novalidate" external-target="scat">
                    <fieldset style="padding: 0px">
                        <section>
                            <label class="label">${m.asString("domain.defined.scat.catid")}</label>
                            <label class="input">
                                <input type="text" name="catid" placeholder="site category id"/>
                            </label>
                        </section>
                        <section>
                            <label class="checkbox"><input type="checkbox" name="includeSub"/><i></i>${m.asString("domain.defined.scat.below")}</label>
                        </section>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}</button>
                <button class="btn btn-primary" name="create">${m.asString("domain.defined.scat.buttons.add")}</button>
            </div>
        </div>
    </div>
</div>

<div id="create-domain-gcat-modal" class="modal fade domain" tabindex="-1" role="dialog" aria-labelledby="myModalLabel5" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 id="myModalLabel5">${m.asString("domain.defined.gcat")}</h5></div>
            <div class="modal-body">
                <form class="smart-form" id="create-domain-gcat-form" method="post" action="domain/source" novalidate="novalidate" external-target="gcat">
                    <fieldset style="padding: 0px">
                        <section>
                            <label class="label">${m.asString("domain.defined.gcat.catid")}</label>
                            <label class="input">
                                <input type="text" name="catid" placeholder="gallery category id"/>
                            </label>
                        </section>
                        <section>
                            <label class="checkbox"><input type="checkbox" name="includeSub"/><i></i>${m.asString("domain.defined.gcat.below")}</label>
                        </section>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}</button>
                <button class="btn btn-primary" name="create">${m.asString("domain.defined.gcat.buttons.add")}</button>
            </div>
        </div>
    </div>
</div>

<div id="gallery-crop-modal" class="modal fade domain" tabindex="-1" role="dialog" aria-labelledby="myModalLabel6" aria-hidden="true">
    <div class="modal-dialog" style="width: 800px">
        <div class="modal-content">
            <div class="modal-header"><h5 id="myModalLabel6">${m.asString("domain.gallery.crop")}</h5></div>
            <div class="modal-body">
                <div style="width: 750px">
                    <img id="galleryImg" src="">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}</button>
                <button class="btn btn-info" name="reset">${m.asString("buttons.form.reset")}</button>
                <button class="btn btn-primary" name="crop">${m.asString("buttons.info.save")}</button>
            </div>
        </div>
    </div>
</div>

<div id="gallery-resize-modal" class="modal fade domain" tabindex="-1" role="dialog" aria-labelledby="myModalLabel7" aria-hidden="true">
    <div class="modal-dialog" style="width: 800px">
        <div class="modal-content">
            <div class="modal-header"><h5 id="myModalLabel7">${m.asString("domain.gallery.resize")}</h5></div>
            <div class="modal-body">
                <div style="width: 750px; height: 400px; overflow: auto; border: 2px;">
                    <img id="resizeImg" src="">
                </div>
                <form class="smart-form" id="resize-gallery-form" method="post" action="domain/source" novalidate="novalidate" external-target="gcat">
                    <fieldset>
                        <div class="row">
                            <section class="col col-6">
                                <label class="label">${m.asString("domain.gallery.resize.width")}</label>
                                <label class="input">
                                    <input type="number" name="width"/>
                                </label>
                            </section>
                            <section class="col col-6">
                                <label class="label">${m.asString("domain.gallery.resize.height")}</label>
                                <label class="input">
                                    <input type="number" name="height"/>
                                </label>
                            </section>
                        </div>
                        <section>
                            <label class="check">
                                <input type="checkbox" name="keepRatio"><i></i> ${m.asString("domain.gallery.resize.scaleratio")}
                            </label>
                        </section>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">${m.asString("buttons.modal.close")}</button>
                <button class="btn btn-info" name="reset">${m.asString("buttons.form.reset")}</button>
                <button class="btn btn-primary" name="resize">${m.asString("buttons.info.save")}</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    pageSetUp();

    var pagefunction = function () {

        function tableHeightSize() {
            if ($('body').hasClass('menu-on-top')) {
                var menuHeight = 68;
                // nav height

                var tableHeight = ($(window).height() - 224) - menuHeight;
                if (tableHeight < (320 - menuHeight)) {
                    $('.table-wrap').css('height', (320 - menuHeight) + 'px');
                } else {
                    $('.table-wrap').css('height', tableHeight + 'px');
                }

            } else {
                var tableHeight = $(window).height() - 224;
                if (tableHeight < 320) {
                    $('.table-wrap').css('height', 320 + 'px');
                } else {
                    $('.table-wrap').css('height', tableHeight + 'px');
                }
            }
        }

        // fix table height
        tableHeightSize();

        $(window).resize(function () {
            tableHeightSize();
        });


        var lastMenuHTML = 'overview.html';
        var lastDomainId = '' ;

        $.ajax({
            url:'/admin/domain/list',
            dataType:'json',
            success:function(data){
                for(var idx in data){
                    var did = data[idx] ;
                    var option = $('<option value="' + did + '">' + did + '</option>') ;
                    option.appendTo($("#domains")) ;
                }

                loadURL("external/domain/overview.html", $('#inbox-content > .table-wrap'));
                lastDomainId = $("#domains").val() ;
            },
            error:function(request,status,error){
                console.log('response', request, status, error) ;
                // until rest api ready...
                loadURL("external/domain/overview.html", $('#inbox-content > .table-wrap'));
            }
        }) ;

        $(".fa-trash-o").click(function () {
            $("#remove-domain-confirm").css('visibility', 'visible');
            $("#removeDomainId").html($("#domains option:selected").text());
            $("#remove-domain-confirm").dialog({
                modal: true,
                buttons: {
                    "${m.asString('domain.remove')}": function () {
                        var removeId = lastDomainId;
                        var win = $(this);

                        if (removeId > ' ') {
                            $.ajax({
                                type: "DELETE",
                                dataType: 'text',
                                url: "/admin/domain/" + $(".choose-sub").val(),
                                data: { },
                                complete: function () {
                                    // $("#query_url").text(this.url) ;
                                },
                                success: function (data) {
                                    $("#domains option:selected").remove();
                                    loadURL("external/domain/article.html", $('#inbox-content > .table-wrap'));
                                    lastMenuHTML = 'article.html' ;
                                    win.dialog("close");
                                }
                            });
                        }
                    },
                    "${m.asString('buttons.modal.cancel')}": function () {
                        $(this).dialog("close");
                    }
                }
            });
        });

        $('.create-open').click(function() {
            $('#create-domain-modal').modal({});
        });

        $("#create-domain-modal button[name=create_domain]").click(function () {
            $("#create-domain-form").submit();
        });

        $('#create-domain-form').validate({
            rules : {
                did : { required: true, pattern: "^[a-z][a-z0-9_]*$", minlength:4, maxlength: 15}
            },
            messages: {
                did : {
                    required: "${m.asString('validation.required', 'Domain ID')}",
                    pattern: "${m.asString('validation.idpattern')}",
                    minlength: "${m.asString('validation.minlength', 4)}",
                    maxlength: "${m.asString('validation.maxlength', 15)}"
                }
            },
            submitHandler: function(form) {
                var newId = $('#did').val() ;
                $.ajax({
                    type: 'POST',
                    dataType: 'text',
                    url: '/admin/domain/' + newId,
                    data: { },
                    complete: function() { },
                    success: function() {
                        if($('#domains option[value=' + newId + ']').length > 0) $('#domains').val(newId) ;
                        else $('#domains').append('<option value="' + newId + '" selected="selected">' + newId + '</option>');

                        $('#create-domain-modal').modal('hide') ;
                    }
                });
            },
            errorPlacement: function(error, element) {
                error.insertAfter(element.parent());
            }
        });

        $(".choose-sub").change(function () {
            loadURL("external/domain/" + lastMenuHTML, $('#inbox-content > .table-wrap'));
            lastDomainId = $('#domains').val();
        });

        $("li.submenu").click(function () {
            $(this).siblings().removeClass("active");
            $(this).addClass("active");
        });
        
        $(".overview-load").click(function () {
            loadURL("external/domain/overview.html", $('#inbox-content > .table-wrap'));
            lastMenuHTML = "overview.html";
        });        

        $(".defined-load").click(function () {
            loadURL("external/domain/defined.html", $('#inbox-content > .table-wrap'));
            lastMenuHTML = "defined.html";
        });

        $(".article-load").click(function () {
            loadURL("external/domain/article.html", $('#inbox-content > .table-wrap'));
            lastMenuHTML = "article.html";
        });

        $(".gallery-load").click(function () {
            loadURL("external/domain/gallery.html", $('#inbox-content > .table-wrap'));
            lastMenuHTML = "gallery.html";
        });
    };

    pagefunction() ;

</script>
